// Written by Jackson Murphy for CS 4480 Computer Networks. February 2016.
// How to run code: from the command-line. Give it an argument specifying the port number

package proxyServer;

import java.io.*;
import java.net.*;

/**
 * A ProxyServer listens for client requests and creates new threads to process the requests. 
 */
public class ProxyServer {

	public static void main(String[] args) throws Exception {
		
		// the port number we'll listen on is specified as a command-line argument.
		int port = 6000;
		
		if(args.length > 0){
			try {
		        port = Integer.parseInt(args[0]);
		    } catch (NumberFormatException e) {
		        System.err.println("Argument" + args[0] + " must be an integer, as it specifies which port number to listen on.");
		        port = 6000; // Fallback to 6000
		    }
		}

		// Set up a socket to listen for incoming client requests
		ServerSocket welcomeSocket = new ServerSocket(port);

		// Continuously listen for a connection, spawn a new thread, and repeat
		while (true) {

			// Create a dedicated socket for the client making a request
			Socket connectionSocket = welcomeSocket.accept();
			
			// Handle the client on its own thread
			new Thread(new proxyServer.MultiThreadServer(connectionSocket)).start();
			
		}
	}
}
